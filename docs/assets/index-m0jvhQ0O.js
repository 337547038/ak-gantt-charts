import{d as W,r as $,i as q,c as T,o as J,a as K,b as y,e as E,f as n,F as G,g as Y,n as Q,t as z,h as Z,j as b,k as ot,l as rt,u as ct,w as X,p as ut,m as dt,_ as vt,q as gt,s as at,v as H,x as j,y as tt,z as pt,A as ht,B as ft,C as nt,D as mt}from"./index-yusM2Z6X.js";const et="data:image/svg+xml,%3c?xml%20version='1.0'%20standalone='no'?%3e%3c!DOCTYPE%20svg%20PUBLIC%20'-//W3C//DTD%20SVG%201.1//EN'%20'http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd'%3e%3csvg%20t='1704272156833'%20class='icon'%20viewBox='0%200%201024%201024'%20version='1.1'%20xmlns='http://www.w3.org/2000/svg'%20p-id='5368'%20xmlns:xlink='http://www.w3.org/1999/xlink'%20width='200'%20height='200'%3e%3cpath%20d='M512%20714.666667c-8.533333%200-17.066667-2.133333-23.466667-8.533334l-341.333333-341.333333c-12.8-12.8-12.8-32%200-44.8%2012.8-12.8%2032-12.8%2044.8%200l320%20317.866667%20317.866667-320c12.8-12.8%2032-12.8%2044.8%200%2012.8%2012.8%2012.8%2032%200%2044.8L533.333333%20704c-4.266667%208.533333-12.8%2010.666667-21.333333%2010.666667z'%20fill='%23666666'%20p-id='5369'%3e%3c/path%3e%3c/svg%3e",I=(c,f)=>{typeof c=="string"&&(c=new Date(c));const p=c.getFullYear(),e=c.getMonth(),a=c.getDate();return new Date(p,e,a+f)},M=c=>{const f=c.getFullYear(),p=(c.getMonth()+1).toString().padStart(2,"0"),e=c.getDate().toString().padStart(2,"0");return`${f}-${p}-${e}`},wt={class:"g-month"},Dt={class:"g-day-date"},_t=W({__name:"dateTimeLine",emits:["changeWidth"],setup(c,{emit:f}){const p=f,e=$(),a=q("propsComm")||{},d=T(()=>a.dateRange.value),v={day:{0:"日",1:"一",2:"二",3:"三",4:"四",5:"五",6:"六"},month:{1:"一",2:"二",3:"三",4:"四",5:"五",6:"六",7:"七",8:"八",9:"九",10:"十",11:"十一",12:"十二"}},x=(r,u)=>{if(u===a.offsetUnit.value+1||r.getDate()===1)return v.month[r.getMonth()+1]+"月"},o=r=>{const u=new Date;return M(r)===M(u)},m=T(()=>{let r=!1,u=-1;d.value.forEach((S,U)=>{o(S)&&(r=!0,u=U)});const k={left:u*a.width.value+a.width.value/2+"px",position:"absolute"};return{visible:r,style:k}}),_=r=>{if([0,6].includes(r.getDay()))return{background:"rgba(247,248,250,0.4)"}},w=r=>{let u=a.width.value;r.deltaY<0?u<100&&(u+=1):u>44&&(u-=1),p("changeWidth",u),r.preventDefault()};return J(()=>{e.value.addEventListener("wheel",w,{passive:!1})}),K(()=>{e.value&&e.value.removeEventListener("wheel",w)}),(r,u)=>(y(),E(G,null,[n("div",{class:"gantt-header",ref_key:"el",ref:e},[(y(!0),E(G,null,Y(d.value,(k,S)=>(y(),E("div",{class:Q(["g-date",{"g-is-today":o(k)}]),key:k.getTime()},[n("span",wt,z(x(k,S)),1),n("div",Dt,[n("span",null,z(v.day[k.getDay()]),1),Z(z(k.getDate().toString().padStart(2,"0")),1)]),n("span",{class:"g-bg-line",style:b(_(k))},null,4)],2))),128))],512),m.value.visible?(y(),E("div",{key:0,class:"g-today-line",style:b(m.value.style)},null,4)):ot("",!0)],64))}}),kt={class:"g-bar-progress"},yt={key:0,class:"g-text"},lt=W({__name:"barProgress",props:{list:{default:()=>[]}},setup(c){const f=c,p=q("propsComm")||{},e=T(()=>p.dateRange.value),a=v=>f.list[M(v)],d=v=>{const x=a(v);return x?{height:`${x/10*100}%`}:null};return(v,x)=>(y(),E("div",kt,[(y(!0),E(G,null,Y(e.value,(o,m)=>(y(),E("div",{class:Q(["item",{"g-is-full":a(o)>=10}]),key:m},[a(o)?(y(),E("span",yt,z(a(o)),1)):ot("",!0),n("span",{class:"g-bar",style:b(d(o))},null,4)],2))),128))]))}}),xt=W({__name:"transform",props:{modelValue:{default:()=>new Date}},emits:["change","update:modelValue"],setup(c,{emit:f}){const p=$(!1),e=$(0),a=f,d=c,v=q("propsComm")||{},x=T(()=>{const m=v.width.value;return{width:m*v.dateRange.value.length+"px",transform:`translateX(${e.value-m*v.offsetUnit.value}px)`,userSelect:"none",position:"relative"}}),o=m=>{p.value=!0;const _=m.pageX-e.value;document.onmousemove=w=>{p.value&&(e.value=w.pageX-_)},document.onmouseup=()=>{p.value=!1;const w=v.width.value,r=Math.round(Math.abs(e.value)/w);let u;const k=Math.abs(e.value)%w;let S=0;e.value>0?(u=I(d.modelValue,-r),k>w/2?S=-k:S=k):(u=I(d.modelValue,r),k>w/2?S=k:S=-k),r>0&&(a("change",u),a("update:modelValue",u)),e.value=S}};return(m,_)=>(y(),E("div",{class:"transform-x",onMousedown:o,style:b(x.value)},[rt(m.$slots,"default")],36))}}),Ct=["onClick"],Et=["title"],$t={class:"g-progress"},St=["onClick"],F=40,Lt=W({__name:"taskDetail",props:{list:{default:()=>[]}},emits:["change","showDetailClick"],setup(c,{expose:f,emit:p}){ct(l=>({"459ecbde":v.value}));const e=c,a=p,d=q("propsComm")||{},v=T(()=>F+"px"),x=$(!1),o=$(-1),m=$({}),_=$({}),w=T(()=>d.dateRange.value||[]),r=T(()=>{const l=[],i=[],h=d.width.value;return e.list.forEach((D,g)=>{const t=O(D.startDate),s=h*t+(m.value[g]||0),C=new Date(D.endDate)<new Date(M(new Date));D.progress<100&&C?D.delayEndDate=M(new Date):D.delayEndDate="";const L=A(D.startDate,D.endDate)*h+(_.value[g]||0),st=N(i,{x:s,y:0,width:L});l.push({style:{transform:`translateX(${s}px)`,width:`${L}px`,top:`${st}px`},...D}),i.push({x:s,y:st,width:L})}),l}),u=T(()=>{let l=0;return r.value.forEach(i=>{const h=parseInt(i.style.top);h>l&&(l=h)}),l+F+10}),k=T(()=>({transform:`translateX(${(d.width.value+1)*d.offsetUnit.value}px)`})),S=l=>{o.value=l},U=()=>{o.value=-1},V=(l,i)=>{if(o.value===-1)return;x.value=!0;const h=i.pageX;let D=0;document.onmousemove=g=>{if(!x.value)return;const t=g.pageX-h;D=t,l==="left"?(m.value[o.value]=t,_.value[o.value]=-t):l==="right"?_.value[o.value]=t:m.value[o.value]=t},document.onmouseup=()=>{let g=Math.ceil(Math.abs(m.value[o.value])/d.width.value);if(l==="right"&&(g=Math.ceil(Math.abs(_.value[o.value])/d.width.value)),g){let t,s;const{startDate:C,endDate:B}=r.value[o.value];D>0?(t=I(C,g),s=I(B,g)):(t=I(C,-g),s=I(B,-g));let L={index:o.value};l==="all"?(L.startDate=M(t),L.endDate=M(s)):l==="left"?L.startDate=M(t):l==="right"&&(L.endDate=M(s)),a("change",L)}x.value=!1,m.value={},_.value={}}},P=l=>l.delayEndDate?{width:`${A(l.startDate,l.delayEndDate)*d.width.value}px`}:null,N=(l,i)=>{for(const h of l)if(R(h,i)){i.y=i.y+F+10,N(l,i);break}return i.y},R=(l,i)=>l.x+l.width<=i.x||l.y+F<=i.y?!1:!(i.x+i.width<=l.x||i.y+F<=l.y),O=l=>{let i=-1;const h=new Date(l);return w.value.forEach((D,g)=>{D.getMonth()===h.getMonth()&&D.getDate()===h.getDate()&&(i=g)}),i},A=(l,i)=>{const h=new Date(l),D=new Date(i),g=Math.abs(D.getTime()-h.getTime());return Math.ceil(g/(1e3*3600*24))+1};return f({minHeight:u}),J(()=>{document.addEventListener("click",U)}),K(()=>{document.removeEventListener("click",U)}),(l,i)=>(y(),E("div",{class:"gantt-task-detail",style:b({height:u.value+"px"})},[r.value.length?(y(!0),E(G,{key:1},Y(r.value,(h,D)=>(y(),E("div",{class:Q(["item",{active:D===o.value,"status-complete":h.progress===100,"status-over":h.delayEndDate}]),key:D,style:b(h.style),onClick:X(g=>S(D),["stop"]),onMousedown:i[2]||(i[2]=X(g=>V("all",g),["stop"]))},[n("span",{class:"g-drag-left",onMousedown:i[0]||(i[0]=X(g=>V("left",g),["stop"]))},null,32),n("div",{class:"g-name",title:h.title},z(h.title),9,Et),n("span",{class:"g-drag-right",onMousedown:i[1]||(i[1]=X(g=>V("right",g),["stop"]))},null,32),n("div",$t,[n("span",{style:b({width:h.progress+"%"})},[n("i",null,z(h.progress)+"%",1)],4)]),n("span",{class:"g-show-detail",onClick:X(g=>a("showDetailClick",h),["stop"])},"详情",8,St),n("span",{class:"g-over-bg",style:b(P(h))},null,4)],46,Ct))),128)):(y(),E("div",{key:0,class:"g-empty-data",style:b(k.value)},"该成员暂无规则时间的事项",4))],4))}}),Tt="data:image/svg+xml,%3c?xml%20version='1.0'%20standalone='no'?%3e%3c!DOCTYPE%20svg%20PUBLIC%20'-//W3C//DTD%20SVG%201.1//EN'%20'http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd'%3e%3csvg%20t='1704272055094'%20class='icon'%20viewBox='0%200%201024%201024'%20version='1.1'%20xmlns='http://www.w3.org/2000/svg'%20p-id='2281'%20xmlns:xlink='http://www.w3.org/1999/xlink'%20width='200'%20height='200'%3e%3cpath%20d='M448%20448H192v128h256v256h128V576h256V448H576V192H448v256z%20m64%20576A512%20512%200%201%201%20512%200a512%20512%200%200%201%200%201024z'%20fill='%230f74fa'%20p-id='2282'%3e%3c/path%3e%3c/svg%3e",Mt="data:image/svg+xml,%3c?xml%20version='1.0'%20standalone='no'?%3e%3c!DOCTYPE%20svg%20PUBLIC%20'-//W3C//DTD%20SVG%201.1//EN'%20'http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd'%3e%3csvg%20t='1704272101171'%20class='icon'%20viewBox='0%200%201024%201024'%20version='1.1'%20xmlns='http://www.w3.org/2000/svg'%20p-id='4413'%20xmlns:xlink='http://www.w3.org/1999/xlink'%20width='200'%20height='200'%3e%3cpath%20d='M341.333333%20512a85.333333%2085.333333%200%201%201-170.666666%200%2085.333333%2085.333333%200%200%201%20170.666666%200z%20m256%200a85.333333%2085.333333%200%201%201-170.666666%200%2085.333333%2085.333333%200%200%201%20170.666666%200z%20m170.666667%2085.333333a85.333333%2085.333333%200%201%200%200-170.666666%2085.333333%2085.333333%200%200%200%200%20170.666666z'%20fill='%2314101C'%20p-id='4414'%3e%3c/path%3e%3c/svg%3e",bt=c=>(ut("data-v-f4409e28"),c=c(),dt(),c),Vt={class:"detail"},It=bt(()=>n("img",{src:Mt,alt:""},null,-1)),Ut=W({__name:"detail",emits:["click"],setup(c,{emit:f}){const p=f,e=a=>{p("click",a)};return(a,d)=>(y(),E("div",Vt,[It,n("ul",null,[n("li",{onClick:d[0]||(d[0]=v=>e("userDetail"))},"成员详情"),n("li",{onClick:d[1]||(d[1]=v=>e("delUser"))},"移除")])]))}}),Bt=vt(Ut,[["__scopeId","data-v-f4409e28"]]),it=gt("ganttChart",{state:()=>({expandList:[]}),actions:{setExpandList(c){if(console.log(this.expandList),this.expandList.includes(c)){const f=this.expandList.indexOf(c);this.expandList.splice(f,1)}else this.expandList.push(c)}}}),Wt={class:"gantt-user-list"},Nt={class:"g-add-btn"},Ht=n("img",{src:Tt,alt:""},null,-1),zt={class:"g-name-title"},Gt=["onClick"],Pt=n("img",{src:et,alt:""},null,-1),Rt=[Pt],Xt=["src"],Ft={class:"g-name"},Yt=["onClick"],Ot=n("div",{class:"item"},[n("div",{class:"g-name-title"},[n("span",{class:"g-name"},"工作负荷")])],-1),At=W({__name:"userList",props:{list:{default:()=>[]},taskDetailHeight:{default:()=>[]}},emits:["toggleClick","click","scroll"],setup(c,{expose:f,emit:p}){const e=p,a=it(),d=$(),v=_=>{d.value.scrollTo(0,_)},x=()=>{e("scroll",d.value.scrollTop)},o=(_,w)=>{a.setExpandList(w),e("toggleClick",w)},m=(_,w)=>{e("click",_,w)};return J(()=>{d.value.addEventListener("scroll",x)}),K(()=>{document.removeEventListener("scroll",x)}),f({setScroll:v}),(_,w)=>(y(),E("div",Wt,[n("div",Nt,[n("button",{onClick:w[0]||(w[0]=r=>e("click","addUser"))},[Ht,Z("添加成员")])]),n("div",{class:"g-scroll",ref_key:"gScrollEl",ref:d},[(y(!0),E(G,null,Y(_.list,(r,u)=>{var k,S,U,V,P;return y(),E("div",{class:"item",key:u},[n("div",zt,[n("span",{class:Q(["g-icon",{expand:(S=(k=at(a))==null?void 0:k.expandList)==null?void 0:S.includes(u)}]),onClick:N=>o(r,u)},Rt,10,Gt),n("img",{src:r.face,alt:"",class:"g-face"},null,8,Xt),n("span",Ft,z(r.name),1),H(Bt,{onClick:N=>m(N,r)},null,8,["onClick"])]),j(n("div",{class:"g-todo",style:b({height:((U=_.taskDetailHeight[u])==null?void 0:U.minHeight)+"px"})},[Z(z(r.todo)+" 事项未规则时间 ",1),n("span",{onClick:N=>e("click","taskDetail",r)},"详情",8,Yt)],4),[[tt,(P=(V=at(a))==null?void 0:V.expandList)==null?void 0:P.includes(u)]])])}),128))],512),Ot]))}}),qt=pt("<p>PN-R895</p><h3>客户反馈小票打印机连接不上网络</h3><ul><li><span>状态</span>未开始</li><li><span>进度</span>50%</li><li><span>周期</span>2021/03/24-2021/04/18</li><li><span>所属项目</span>项目协同项目</li></ul>",3),Jt=[qt],Kt=W({__name:"dialog",props:{data:{default:()=>[]}},setup(c){const f=c,p=T(()=>{const{transform:e,top:a=0}=f.data.style||{};return{transform:e,top:parseInt(a)+160+"px"}});return(e,a)=>(y(),E("div",{class:"g-task-detail-dialog",style:b(p.value)},Jt,4))}}),Qt={class:"container"},Zt=n("img",{src:et,alt:""},null,-1),jt=[Zt],te=n("img",{src:et,alt:""},null,-1),ee=[te],se=W({name:"ganttCharts",__name:"index",props:{width:{default:50},offsetUnit:{default:15},data:{default:()=>[]}},emits:["getData","updateTaskDetail","getTaskDetail","otherEvent"],setup(c,{emit:f}){const p=c,e=f,a=$(new Date),d=$(),v=$(),x=it(),o=$(p.offsetUnit),m=T(()=>{const t=o.value*2,s=I(a.value,t),C=I(a.value,-t),B=[],L=C;for(;L<=s;)B.push(new Date(L)),L.setDate(L.getDate()+1);return B}),_=T(()=>{const t={};return p.data.forEach(s=>{Object.keys(s.progress).forEach(C=>{t[C]?t[C]+=s.progress[C]:t[C]=s.progress[C]})}),t}),w=$(),r=$(),u=$(p.width);ft("propsComm",{width:u,offsetUnit:o,dateRange:m});const k=t=>{u.value=t},S=t=>{e("getTaskDetail",t)},U=(t,s)=>{s.startDate&&(t[s.index].startDate=s.startDate),s.endDate&&(t[s.index].endDate=s.endDate),e("updateTaskDetail",t[s.index])},V=t=>{nt(()=>{e("getData",M(m.value[0]),M(m.value[m.value.length-1]),x.expandList,t)})},P=(t,s)=>{e("otherEvent",t,s)},N=t=>x.expandList.includes(t),R=$(!1),O=$({}),A=t=>{R.value=!0,O.value=t},l=()=>{R.value=!1},i=()=>{r.value.setScroll(w.value.scrollTop)},h=t=>{w.value.scrollTo(0,t)},D=t=>{let s;t==="prev"?s=I(a.value,-o.value*2):s=I(a.value,o.value*2),a.value=s,V(t)},g=()=>{nt(()=>{const t=v.value.offsetWidth,s=parseInt(((t-200)/p.width).toString());o.value=parseInt((s/2).toString()),V("onMounted")})};return J(()=>{g(),document.addEventListener("click",l),w.value.addEventListener("scroll",i),window.addEventListener("resize",g)}),K(()=>{document.removeEventListener("click",l),w.value.removeEventListener("scroll",i),window.removeEventListener("resize",g)}),(t,s)=>(y(),E("div",Qt,[n("div",{class:"gantt-chart",ref_key:"ganttChartsEl",ref:v},[n("div",{class:"g-btn-prev g-transform-btn",onClick:s[0]||(s[0]=C=>D("prev"))},jt),H(At,{ref_key:"userListEl",ref:r,onToggleClick:S,list:t.data,onClick:P,taskDetailHeight:d.value,onScroll:h},null,8,["list","taskDetailHeight"]),H(xt,{modelValue:a.value,"onUpdate:modelValue":s[1]||(s[1]=C=>a.value=C),onChange:s[2]||(s[2]=C=>V("drag"))},{default:ht(()=>[H(_t,{onChangeWidth:k}),n("div",{class:"g-scroll",ref_key:"gScrollEl",ref:w},[(y(!0),E(G,null,Y(t.data,(C,B)=>(y(),E(G,{key:B},[H(lt,{list:C.progress},null,8,["list"]),j(H(Lt,{list:C.list,onChange:L=>U(C.list,L),onShowDetailClick:A,ref_for:!0,ref_key:"taskDetailEl",ref:d},null,8,["list","onChange"]),[[tt,N(B)]])],64))),128))],512),H(lt,{list:_.value},null,8,["list"]),j(H(Kt,{data:O.value},null,8,["data"]),[[tt,R.value]])]),_:1},8,["modelValue"]),n("div",{class:"g-btn-next g-transform-btn",onClick:s[3]||(s[3]=C=>D("next"))},ee)],512)]))}}),ne=W({__name:"index",setup(c){const f=$([]),p=(v,x,o,m)=>{if(console.log("加载数据",v,x),f.value=[{name:"张三",face:"/face.webp",todo:5,progress:{"2024-01-10":5,"2024-01-12":1,"2024-01-33":12}},{name:"李四",face:"/face.webp",todo:0,progress:{"2024-01-13":5,"2024-01-12":7,"2024-01-17":12},id:2}],o!=null&&o.length)for(const _ in o)e(o[_])},e=v=>{console.log("展开用户详情"),f.value[v].list=[{startDate:"2024-01-15",endDate:"2024-01-19",title:"将生产环境和测试环境服务器迁移到腾讯云将生产环境和测试环境服务器迁移到腾讯云",progress:10},{startDate:"2024-01-13",endDate:"2024-01-18",title:"将生产环境和",progress:0},{startDate:"2024-01-10",endDate:"2024-01-17",title:"通过访问邀请",progress:100}]},a=v=>{},d=(v,x)=>{};return(v,x)=>(y(),mt(se,{data:f.value,onGetData:p,onGetTaskDetail:e,onUpdateTaskDetail:a,onOtherEvent:d},null,8,["data"]))}});export{ne as default};
